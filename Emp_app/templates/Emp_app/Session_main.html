{% extends "Emp_app/base.html" %}

{% load lower_filter %}

{% load custom_filters %}

{% block css %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelector(".filter-icon").addEventListener("click", function () {
            var dropdown = document.querySelector(".dropdowns"); 
            dropdown.style.display = dropdown.style.display === "none" ? "flex" : "none";
        });

        document.getElementById("date-icon").addEventListener("click", function () {
            var fromDate = document.getElementById("from-date");
            var toDate = document.getElementById("to-date");
            fromDate.style.display = fromDate.style.display === "none" ? "block" : "none";
            toDate.style.display = toDate.style.display === "none" ? "block" : "none";
        });
    });

    function showpopup() {
        document.getElementById('popup').style.display = 'flex';
        var row = event.target.closest('tr'); 
        var cells = row.querySelectorAll('td'); 
        document.getElementById('emp_id').value = cells[1].textContent; 
        document.getElementById('date').value = cells[0].textContent; 
        document.getElementById('Program').value = cells[3].textContent;
        document.getElementById('Project').value = cells[4].textContent; 
        document.getElementById('Center_Type').value = cells[6].textContent; 
        document.getElementById('Activity').value = cells[5].textContent; 
        document.getElementById('session_number').value = cells[7].textContent; 
        document.getElementById('Trainer_Type').value = cells[9].textContent;
        document.getElementById('Duration').value = cells[12].textContent; 
        document.getElementById('Status').value = cells[13].textContent; 
        document.getElementById('Beneficiaries').value = cells[10].textContent; 
        document.getElementById('Category').value = cells[11].textContent; 
        document.getElementById('Sponsor').value = cells[8].textContent; 
        document.getElementById('Comment').value = cells[14].textContent;

        var resourceTypeText = cells[2].textContent; 
        var programText = cells[3].textContent; 
        var centreTypeText = cells[6].textContent; 

        document.getElementById('resourceType').value = getResourceTypeValue(resourceTypeText);
        document.getElementById('Program').value = getProgramValue(programText);
        document.getElementById('Center_Type').value = getCentreTypeValue(centreTypeText);

       

        toggleEdit();
    }

   
    function getResourceTypeValue(text) {
        
        if (text === 'Employee') {
            return '1';
        } else if (text === 'Part-time') {
            return '2';
        } else if (text === 'Consultant') {
            return '3';
        }
       
    }

    function getProgramValue(text) {
        switch (text) {
            case 'Bridge Course':
                return '1';
            case 'Academics':
                return '2';
            case 'After School Program':
                return '3';
            case 'Awareness Sessions':
                return '4';
            case 'Camps(Summer/Winter)':
                return '5';
            case 'Career Guidance':
                return '6';
            case 'Computer Coaching-Advanced':
                return '7';
            case 'Computer Coaching-Basics with Typing':
                return '8';
            case 'Computer Coaching-Basics without Typing':
                return '9';
            case 'Computer Coaching-Typing':
                return '10';
            case 'Counselling':
                return '11';
            case 'E2E(Education to Employability)':
                return '12';
            case 'Emotional Management':
                return '13';
            case 'Exam Readiness':
                return '14';
            case 'Gender Sensitivity':
                return '15';
            case 'Internship':
                return '16';
            case 'Integrated Program':
                return '17';
            case 'Kannada':
                return '18';
            case 'Life Skills':
                return '19';
            case 'Office Assistant':
                return '20';
            case 'Parental Guidance':
                return '21';
            case 'Personality Development':
                return '22';
            case 'Soft Skills':
                return '23';
            case 'Software Development':
                return '24';
            case 'Spoken English':
                return '25';
            case 'Tailoring':
                return '26';
            case 'Tailoring-Tassel Typing':
                return '27';
            case 'Tally':
                return '28';
            case 'Teacher Development':
                return '29';
            case 'TTT':
                return '30';
            case 'Wellbeing':
                return '31';
            case 'Women Development':
                return '32';
            case 'WSD':
                return '33';
            default:
                return ''; 
        }
    }




    function getCentreTypeValue(text) {
        // Mapping of text to option value for centre type dropdown
        // Example:
        if (text === 'DJ_halli 1') {
            return '1';
        } else if (text === 'DJ_halli 2') {
            return '2';
        } else if (text === 'Bagalur') {
            return '3';
        } else if (text === 'Mylanahalli') {
            return '4';
        } else if (text === 'Kannur') {
            return '5';
        } e
        // Add more mappings as needed
    } 


    function hidePopup() {
        document.getElementById('popup').style.display = 'none';
    }

    function validateAndSave(isDuplicate = false) {

        saveData(isDuplicate);
    }



    function applyFilters() {
        var selectedProgram = document.getElementById('program-select').value;
        var selectedProject = document.getElementById('project-select').value;
        var selectedCenter = document.getElementById('center-select').value;
        var selectedTrainer = document.getElementById('trainer-select').value;

        fetch('/filter_sessions/', { 
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken') 
            },
            body: JSON.stringify({
                program: selectedProgram,
                project: selectedProject,
                center: selectedCenter,
                trainer: selectedTrainer,
            })
        })
            .then(response => response.json())
            .then(data => {
                updateTable(data);
            });
    }




    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function updateTable(data) {
    }


    function searchPrograms() {
        var input, filter, select, options, option, i;
        input = document.getElementById("program-search");
        filter = input.value.toUpperCase();
        select = document.getElementById("program-select");
        options = select.getElementsByTagName("option");

        for (i = 0; i < options.length; i++) {
            option = options[i];
            if (option.innerHTML.toUpperCase().indexOf(filter) > -1) {
                option.style.display = "";
            } else {
                option.style.display = "none";
            }
        }
    }
</script>

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
    }

    h1 {
        margin-left: 18%;
        margin-top: -5%;
    }

    .container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 10px;
        padding: 20px;
        position: relative;
        margin-right: 55%;
        margin-top: 4%;
    }

    .search-box input, .search-box button, .dropdown select, .dropdown input[type="date"] {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin: 5px;
    }

    .search-box button, .dropdown button {
        background-color: #d7ca94;
        cursor: pointer;
    }

    .filter-icon {
        font-size: 23px;
        cursor: pointer;
        margin: 5px;
    }


    .dropdowns {
        display: none;
        flex-wrap: wrap;
        gap: 5px;
        align-items: center;
        margin-top: 10%;
        position: absolute;
    }


    @media (max-width: 768px) {
        .container {
            flex-direction: column;
        }
    }


    #sessionsTable {
        display: block;
        overflow: auto;
        max-height: 530px;
        width: 45%;
        margin-top: 50px;
    }

    .table th, .table td {
        white-space: nowrap;
        border: 1px solid #ddd;
        padding: 7px;
        text-align: center;
    }

    #bts {
        margin-left: 65%;
        background-color: orange;
        width: 100px;
        height: 15%;
    }


    .form-columns {
        display: flex;
        justify-content: space-between;
    }

    .form-column {
        width: 48%; 
    }



    .tdtd {
        display: flex;
        align-items: center;
        justify-content: center;
        justify-content: space-evenly;
        cursor: pointer;
    }

    .popup {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); 
        justify-content: center;
        align-items: center;
    }

    .blank-box {
        width: 60%;
        max-width: 600px;
        background-color: white;
        border: 1px solid #ccc;
        margin: 10px auto;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    }

    .scroll-container {
        overflow: auto;
        max-height: 500px;
    }

        .scroll-container label {
            display: block; 
            margin: 10px 0 5px;
            font-weight: bold;
        }

        .scroll-container input[type="text"],
        .scroll-container input[type="date"],
        .scroll-container select {
            width: 90%; 
            margin: 5px 0; 
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px; 
        }

        .scroll-container.comment-box {
            width: 90%;
            margin: 10px 0; 
            padding: 8px;
        }

            .scroll-container.comment-box textarea {
                width: 100%; 
                height: 100px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }


        .scroll-container#btnSave {
            width: auto;
            background-color: orange;
            color: white; 
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            margin-right: 10px;
            cursor: pointer; 
            box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);
            font-weight: bold; 
            transition: background-color 0.3s ease; 
            display: block; 
        }

        .scroll-container#btnSaveDuplicate {
            width: auto; 
            background-color: orange;
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            margin-right: 10px;
            cursor: pointer; 
            box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            transition: background-color 0.3s ease;
            display: block;
        }

        .scroll-container.button-container button {
            background-color: orange; 
            color: white; 
            padding: 10px 20px;
            border: none; 
            border-radius: 5px;
            margin-right: 10px; 
            cursor: pointer; 
            box-shadow: 3px 3px 5px rgba(0, 0, 0, 0.2); 
            font-weight: bold; 
            transition: background-color 0.3s ease;
        }

    @media (max-width: 768px) {
        .blank-box {
            width: 80%; 
        }

        .scroll-container input[type="text"],
        .scroll-container input[type="date"],
        .scroll-container select,
        .scroll-container.comment-box {
            width: 100%;
        }
    }

    .date-input {
        display: none; 
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin: 5px;
    }

        .date-input::-webkit-input-placeholder { 
            color: #888;
            font-style: italic;
        }

        .date-input::-moz-placeholder { 
            color: #888;
            font-style: italic;
        }

        .date-input:-ms-input-placeholder { 
            color: #888;
            font-style: italic;
        }

        .date-input:-moz-placeholder { 
            color: #888;
            font-style: italic;
        }

    #program-select, #project-select, #center-select, #trainer-select {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin: 5px;
    }

    #but {
        margin-left: 40%;
        width: 5%;
        background: orange;
    }

    #btnSave, #btnSaveDuplicate {
        background: orange;
        width: 11%;
    }
</style>

{% endblock %}


{% block content %}

<h1>Session Details</h1>

<div class="container">
    <div class="search-box">
        <input type="text" name="q" placeholder="Search (Program, Activity)" required>
        <button type="submit" class="search-btn"><i class="fas fa-search"></i></button>
    </div>

    <i class="fas fa-filter filter-icon"></i>
    <div id="date-icon" style="cursor:pointer;">
        📅
    </div>

    <input type="date" id="from-date" class="date-input" placeholder="From Date" style="display:none;">
    <input type="date" id="to-date" class="date-input" placeholder="To Date" style="display:none;">

    <div class="dropdowns">

        <select id="resource-select">
            <option value="">Select an Center</option>
            {% for resource in resources %}
            <option value="{{ resource.resource_type }}">{{resource.resource_type|resourcetype_to_string}}}</option>
            {% endfor %}
        </select>

        <select id="program-select">
            <option>Select an Program</option>
            {% for program in program_names %}

            <option value="{{ program.program_name }}">{{ program.program_name|program_to_string }}</option>
            {% endfor %}
        </select>

        <select id="project-select">
            <option>Select Project</option>
            {% for project in project_names %}
            <option value="{{ project.project_name }}">{{ project.project_name }}</option>
            {% endfor %}
        </select>




        <select id="center-select">
            <option value="">Select an Center</option>
            {% for center in centers %}
            <option value="{{ center.center_type }}">{{ center.center_type|centertype_to_string }}</option>
            {% endfor %}
        </select>

        <select id="trainer-select">
            <option value="">Select an Trainer</option>
            {% for trainer in trainers %}
            <option value="{{ trainer.trainer_type }}">{{ trainer.trainer_type|TrainerType_to_string }}</option>  <!-- Adjusted to 'trainer_type' -->
            {% endfor %}
        </select>

        <button type="button" onclick="applyFilters()" style="background:orange;">Filter</button>
    </div>
</div>

<button id="but" onclick="openCreatePage()">Create</button>

<form method="post" action="{% url 'save_session' %}">

    {% csrf_token %}

    <div id="scrollable-table">

        <table id="sessionsTable" class="table">
            <tr bgcolor="orange">

                <th>Date</th>
                <th>Emp_id</th>
                <th>Resource Name</th>
                <th>Program</th>
                <th>Project</th>
                <th>Activity</th>
                <th>Center_Type</th>
                <th>Session_Number</th>
                <th>Sponsor</th>
                <th>Trainer_Type</th>
                <th>beneficiaries</th>
                <th>Category</th>
                <th>Duration</th>
                <th>Status</th>
                <th>Comments</th>
                <th>Action</th>




            </tr>

            {% for program in programs %}
            <tr bgcolor="white">
                <td>{{program.date}}</td>
                <td>{{program.emp.emp_id}}</td>
                <td>{{program.emp.resource_type|resourcetype_to_string}}</td>
                <td>{{program.xref.program_name|program_to_string}}</td>
                <td>{{program.xref.project_name}}</td>
                <td>{{program.activity }}</td>
                <td>{{program.center_type|centertype_to_string}}</td>
                <td>{{program.session_number}}</td>
                <td>{{program.sponsor}}</td>
                <td>{{program.trainer_type}}</td>
                <td>{{program.beneficiaries }}</td>
                <td>{{program.category }}</td>
                <td>{{program.duration}}</td>
                <td>{{program.status}}</td>
                <td>{{program.comments }}</td>




                <td class="tdtd">
                    <button class="add-row-button" onclick="showpopup()"> <i class="fa-solid fa-eye" style="color: #ff7b00;"></i> </button>
                </td>


            </tr>
            {% endfor %}

        </table>
    </div>

    <script>
        function openCreatePage() {
            var url = "{% url 'createpage' %}"; 
            window.open(url, 'Create Page', 'height=600,width=800');
        }
    </script>

    <div id="popup" class="popup">
        <div class="blank-box">
            <div class="scroll-container">

                <h2>Details</h2>
                <label for="Emp_id">Emp_id</label>
                <input type="text" id="emp_id" name="emp_id" data-dbname="emp_id"><br>

                <label for="date">Date</label>
                <input type="date" id="date" name="date"><br>

                <label for="ResourceName">resource_type</label>
                <select id="resourceType" name="resourceType" data-dbname="resource_type" required disabled>
                    <option value="">Select an option</option>
                    <option value="1">Employee</option>
                    <option value="2">Part-time</option>
                    <option value="3">Consultant</option>
                </select>

                <label for="Program">Program</label>
                <select id="Program" name="Program" required>
                    <option value="Select an option" data-dbname="SelectAnOption">Select an option</option>
                    <option value="1" data-dbname="BridgeCourse">Bridge Course</option>
                    <option value="2" data-dbname="Academics">Academics</option>
                    <option value="3" data-dbname="AfterSchoolProgram">After School Program</option>
                    <option value="4" data-dbname="AwarenessSessions">Awareness Sessions</option>
                    <option value="5" data-dbname="Camps">Camps(Summer/Winter)</option>
                    <option value="6" data-dbname="CareerGuidance">Career Guidance</option>
                    <option value="7" data-dbname="ComputerCoachingAdvanced">Computer Coaching-Advanced</option>
                    <option value="8" data-dbname="ComputerCoachingBasicsWithTyping">Computer Coaching-Basics with Typing</option>
                    <option value="9" data-dbname="ComputerCoachingBasicsWithoutTyping">Computer Coaching-Basics without Typing</option>
                    <option value="10" data-dbname="ComputerCoachingTyping">Computer Coaching-Typing</option>
                    <option value="11" data-dbname="Counselling">Counselling</option>
                    <option value="12" data-dbname="E2E">E2E(Education to Employability)</option>
                    <option value="13" data-dbname="EmotionalManagement">Emotional Management</option>
                    <option value="14" data-dbname="ExamReadiness">Exam Readiness</option>
                    <option value="15" data-dbname="GenderSensitivity">Gender Sensitivity</option>
                    <option value="16" data-dbname="Internship">Internship</option>
                    <option value="17" data-dbname="IntegratedProgram">Integrated Program</option>
                    <option value="18" data-dbname="Kannada">Kannada</option>
                    <option value="19" data-dbname="LifeSkills">Life Skills</option>
                    <option value="20" data-dbname="OfficeAssistant">Office Assistant</option>
                    <option value="21" data-dbname="ParentalGuidance">Parental Guidance</option>
                    <option value="22" data-dbname="PersonalityDevelopment">Personality Development</option>
                    <option value="23" data-dbname="SoftSkills">Soft Skills</option>
                    <option value="24" data-dbname="SoftwareDevelopment">Software Development</option>
                    <option value="25" data-dbname="SpokenEnglish">Spoken English</option>
                    <option value="26" data-dbname="Tailoring">Tailoring</option>
                    <option value="27" data-dbname="TailoringTasselTyping">Tailoring-Tassel Typing</option>
                    <option value="28" data-dbname="Tally">Tally</option>
                    <option value="29" data-dbname="TeacherDevelopment">Teacher Development</option>
                    <option value="30" data-dbname="TTT">TTT</option>
                    <option value="31" data-dbname="Wellbeing">Wellbeing</option>
                    <option value="32" data-dbname="WomenDevelopment">Women Development</option>
                    <option value="33" data-dbname="WSD">WSD</option>

                </select>
                <br>


                <label for="Project">Project</label>
                <input type="text" id="Project" name="Project"><br>

                <label for="Activity">Activity</label>
                <input type="text" id="Activity" name="Activity"><br>

                <label for="Center_Type">Center_Type</label>
                <select id="Center_Type" name="Center_Type" required>
                    <option value="Select an option">Select an option</option>
                    <option value="1" data-dbname="DJ_halli 1">DJ_halli 1</option>
                    <option value="2" data-dbname="DJ_halli 2">DJ_halli 2</option>
                    <option value="3" data-dbname="Bagalur">Bagalur</option>
                    <option value="4" data-dbname="Mylanahalli">Mylanahalli</option>
                    <option value="5" data-dbname="Kannur">Kannur</option>
                </select>
                <br>

                <label for="Session_number">Session Number</label>
                <input type="text" id="session_number" name="Session_number"><br>

                <label for="Sponsor">Sponsor</label>
                <select id="Sponsor" name="Sponsor" required>
                    <option value="">Select an option</option>
                    <option value="1" data-dbname="Vajra">Vajra</option>
                    <option value="2" data-dbname="Bridge">Bridge</option>
                    <option value="3" data-dbname="TasteMaster">Taste Master</option>
                    <option value="4" data-dbname="LICT">LICT</option>
                    <option value="5" data-dbname="Others">Others</option>

                </select>
                <br>

                <label for="Trainer_Type">Trainer Type</label>
                <select id="Trainer_Type" name="Trainer_Type" required>
                    <option value="">Select an option</option>
                    <option value="1" data-dbname="Lead">Lead</option>
                    <option value="2" data-dbname="Co-Facilator">Co-Facilator</option>
                    <option value="3" data-dbname="Volunteer">Volunteer</option>
                </select>
                <br>

                <label for="Beneficiaries">Beneficiaries</label>
                <input type="number" id="Beneficiaries" name="Beneficiaries" data-dbname="Beneficiaries" style="width: 90%; margin: 5px 0; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" min="0">
                <br>

                <label for="Category">Category</label>
                <select id="Category" name="Category" required>
                    <option value="Select an option" data-dbname="SelectAnOption">Select an option</option>
                    <option value="1" data-dbname="Consultant">Consultant</option>
                    <option value="2" data-dbname="Employee">Employee</option>
                    <option value="3" data-dbname="Internship">Internship</option>
                    <option value="4" data-dbname="NewVolunteer">New-Volunteer</option>
                    <option value="5" data-dbname="ExVolunteer">Ex-Volunteer</option>
                </select>


                <label for="Duration">Duration</label>
                <input type="number" id="Duration" name="Duration" data-dbname="Duration" style="width: 90%;margin: 6px 0;padding: 9px;border: 1px solid #ccc;border-radius: 4px;" min="0">
                <br>

                <label for="Status">Status</label>
                <select id="Status" name="Status" required>
                    <option value="Select an option" data-dbname="SelectAnOption">Select an option</option>
                    <option value="1" data-dbname="Start">Start</option>
                    <option value="2" data-dbname="OnGoing">On-Going</option>
                    <option value="3" data-dbname="OnHold">On-Hold</option>
                    <option value="4" data-dbname="Completed">Completed</option>
                    <option value="5" data-dbname="Orientation">Orientation</option>
                    <option value="6" data-dbname="Travel">Travel</option>

                </select>
                <br>

                <label for="Comment">Comment</label>
                <div class="comment-box">
                    <textarea id="Comment" name="comment" placeholder="Write our comment here"></textarea>
                </div>

                <button id="editButton" type="button" onclick="toggleEdit()">Edit</button>
                <br>

                <button id="updateButton" type="submit" disabled>Update</button>
                <br>

                <br>
                <button onclick="hidePopup()" id="btnSaveDuplicate">Close</button>
                <br>
            </div>
        </div>
    </div>

</form>

<p>Total number of records: {{ total_count }}</p>

<div class="pagination">
    {% if programs.has_previous %}
    <a href="?page=1">&laquo; 1</a>
    <a href="?page={{ programs.previous_page_number }}">2</a>
    {% endif %}

    <span class="current-page">Page {{ programs.number }} of {{ programs.paginator.num_pages }}</span>

    {% if programs.has_next %}
    <a href="?page={{ programs.next_page_number }}">3</a>
    <a href="?page={{ programs.paginator.num_pages }}">4 &raquo;</a>
    {% endif %}
</div>

    {% endblock %}